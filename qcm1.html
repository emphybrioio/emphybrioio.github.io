<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questions pour Enfants</title>
    <!-- Bootstrap CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #ececec;
        }

        .container {
            max-width: 700px;
        }

        h1 {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            color: #ff6347;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(-10px);
            }
        }

        .card {
            background-color: #fff3cd;
            border-radius: 20px;
            border: 2px solid #ffb703;
        }

        h5 {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            color: #007bff;
        }

        .form-check-label {
            font-size: 18px;
        }

        .text-success {
            color: #28a745 !important;
        }

        .text-danger {
            color: #dc3545 !important;
        }

        .score-box {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-size: 24px;
            color: black;
            /* Default color for score */
        }

        /* Style for the modal */
        .modal-content {
            background-color: #fff3cd;
            border-radius: 15px;
            border: 3px solid #ffb703;
        }

        .modal-title {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-size: 24px;
            color: #007bff;
            text-align: center;
            width: 100%;
        }

        .modal-body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            font-size: 20px;
            color: #ff6347;
            text-align: center;
        }

        .modal-footer {
            justify-content: center;
        }

        .btn-primary {
            background-color: #ff6347;
            border: none;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        /* Style for the image */
        #success-image {
            display: block;
            margin: 10px auto;
            max-width: 100%;
            height: auto;
        }
    </style>
</head>

<body>

    <div class="container mt-5">
        <h1 class="text-center mb-4">Jeu des Questions 🎉</h1>

        <div class="card p-4 shadow-sm" id="questions-container">
            <!-- Questions -->
        </div>
    </div>

    <!-- Modal for the congratulations message -->
    <div class="modal fade" id="confettiModal" tabindex="-1" aria-labelledby="confettiModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confettiModalLabel">Félicitations ! 🎉</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Bravo !!! <br> Tu as trouvé toutes les bonnes réponses !
                    <!-- Image added here -->
                    <img id="success-image" src="images/pibby.png" alt="Succès !" width="150px">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="resetPage()">Valider</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Inclusion de Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Inclusion de js-yaml -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <!-- Confetti animation -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        // Function to shuffle an array (Fisher-Yates Shuffle Algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to display the questions and answers in random order
        function displayQuestions(data) {
            const container = document.getElementById('questions-container');

            // Shuffle the questions
            const shuffledQuestions = shuffleArray(data);

            shuffledQuestions.forEach((item, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question', 'mb-3');

                const questionTitle = document.createElement('h5');
                questionTitle.textContent = `${index + 1}. ${item.quest} 🐰`;
                questionDiv.appendChild(questionTitle);

                // Shuffle the responses for each question
                const shuffledResponses = shuffleArray(item.responses);

                shuffledResponses.forEach((response, i) => {
                    const formCheckDiv = document.createElement('div');
                    formCheckDiv.classList.add('form-check');

                    const input = document.createElement('input');
                    input.classList.add('form-check-input');
                    input.type = 'radio';
                    input.name = `q${index + 1}`;
                    input.value = response.val ? "1" : "-1";
                    input.id = `q${index + 1}a${i}`;

                    const label = document.createElement('label');
                    label.classList.add('form-check-label');
                    label.textContent = response.resp;
                    label.setAttribute('for', `q${index + 1}a${i}`);

                    formCheckDiv.appendChild(input);
                    formCheckDiv.appendChild(label);
                    questionDiv.appendChild(formCheckDiv);
                });

                container.appendChild(questionDiv);
            });
        }

        // Function that calculates the score and checks if all answers are correct
        function updateScore() {
            let score = 0;
            let totalQuestions = 0;
            const questions = document.querySelectorAll('.question');

            questions.forEach((question) => {
                totalQuestions++;
                const inputs = question.querySelectorAll('input[type="radio"]');

                // Reset label colors
                inputs.forEach((input) => {
                    const label = question.querySelector(`label[for="${input.id}"]`);
                    label.classList.remove('text-success', 'text-danger');
                });

                // Check the selected answer
                const selected = question.querySelector('input[type="radio"]:checked');
                if (selected) {
                    score += parseInt(selected.value);

                    // Apply colors based on answer correctness
                    const selectedLabel = question.querySelector(`label[for="${selected.id}"]`);
                    if (selected.value == "1") {
                        selectedLabel.classList.add('text-success'); // Green for correct answer
                    } else {
                        selectedLabel.classList.add('text-danger'); // Red for wrong answer
                    }
                }
            });

            const scoreBox = document.querySelector('.score-box');
            const scoreElement = document.getElementById('score');
            scoreElement.textContent = score;

            // Change score text color based on value
            if (score > 0) {
                scoreBox.style.color = 'green';
            } else if (score < 0) {
                scoreBox.style.color = 'red';
            } else {
                scoreBox.style.color = 'black';
            }

            // Check if all answers are correct
            if (score === totalQuestions) {
                triggerConfetti();
                showCongratsModal(); // Show modal with congratulations
            }
        }

        // Function to trigger confetti explosion
        function triggerConfetti() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        // Function to show congratulations modal
        function showCongratsModal() {
            const modalElement = document.getElementById('confettiModal');
            const modal = new bootstrap.Modal(modalElement);

            // Add event listener to refresh page when modal is closed
            modalElement.addEventListener('hidden.bs.modal', resetPage);

            modal.show();
        }

        // Function to reset the page
        function resetPage() {
            window.location.reload(); // Reload the page to reset everything
        }

        // Fetch and load the YAML file
        function loadYAML() {
            fetch('qcm1.yaml')
                .then(response => response.text())
                .then(yamlText => {
                    const data = jsyaml.load(yamlText);
                    displayQuestions(data);
                })
                .catch(error => console.error('Erreur de chargement du fichier YAML:', error));
        }

        // Load the questions when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadYAML();

            // Attach 'change' event to each radio button to update the score and colors
            document.addEventListener('change', (event) => {
                if (event.target.type === 'radio') {
                    updateScore();
                }
            });
        });

    </script>

    <div class="container text-center mt-4">
        <h4 class="score-box">Score actuel : <span id="score">0</span></h4>
    </div>

</body>

</html>